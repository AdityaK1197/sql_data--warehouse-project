----1) Bronze layer is extracting all the data from csv files into respective tables
----2) silver layer is transforing data and loading into tables of silver layer.
----3) Gold layer is focusing on refining and modeling data so it can be used by analyst, data scientist & BI

CREATE VIEW gold.dim_customers As
select
ROW_NUMBER() over (order by ci.cst_id) customer_key,
ci.cst_id As customer_id,
ci.cst_key As customer_number,
ci.cst_firstname As firstname,
ci.cst_lastname As lastname,
la.cntry As country,
ci.cst_marital_status As marital_status,
CASE
WHEN ci.cst_gndr != 'n/a' then ci.cst_gndr
ELSE COALESCE(ca.gen,'n/a') END AS gender,
ca.bdate As birthdate,
ci.cst_create_date As create_date
from silver.crm_cust_info ci
LEFT JOIN silver.erp_cust_az12 ca 
		on ci.cst_key = ca.cid
LEFT JOIN silver.erp_loc_a101 la 
		on ci.cst_key  = la.cid


CREATE VIEW gold.dim_products As
SELECT 
ROW_NUMBER() over (order by pn.prd_start_dt, pn.prd_key) as product_key,
pn.prd_id AS product_id,
pn.prd_key As product_number,
pn.prd_nm As product_name,
pn.cat_id As category_id,
pc.cat As category,
pc.subcat As subcategory,
pc.maintenance,
pn.prd_cost As cost,
pn.prd_line As product_line,
pn.prd_start_dt As start_date
FROM silver.crm_prd_info pn
LEFT JOIN silver.erp_px_cat_g1v2 pc 
		on pn.cat_id = pc.id
WHERE pn.prd_end_dt IS NULL   --------Filter out all historical data
